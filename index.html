<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kindle å¤©æ°”æ—¥å†</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #fff;
            color: #000;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            font-size: 18px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ccc;
        }
        
        .weather-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        
        .weather-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .weather-icon {
            font-size: 48px;
        }
        
        .weather-temp {
            font-size: 36px;
            font-weight: bold;
        }
        
        .weather-desc {
            text-align: center;
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .detail-item {
            text-align: center;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 3px;
        }
        
        .calendar-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        
        .today-info {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .today-date {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .today-weekday {
            font-size: 24px;
            margin-bottom: 10px;
            color: #666;
        }
        
        .today-lunar {
            font-size: 20px;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 3px;
            display: inline-block;
        }
        
        .huangli-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
        }
        
        .huangli-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .huangli-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .huangli-item {
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 3px;
        }
        
        .huangli-item h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        
        .huangli-item p {
            margin: 0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 20px;
        }
        
        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 3px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Kindle å¤©æ°”æ—¥å†</h1>
            <div id="location">å®šä½ä¸­...</div>
        </div>
        
        <div id="weather-container" class="weather-section" style="display: none;">
            <div class="weather-main">
                <div class="weather-icon" id="weather-icon">â˜€ï¸</div>
                <div class="weather-temp" id="temp">--Â°C</div>
            </div>
            <div class="weather-desc" id="weather-desc">è·å–å¤©æ°”ä¸­...</div>
            <div class="weather-details">
                <div class="detail-item">
                    <div>æ—¥å‡º</div>
                    <div id="sunrise">--:--</div>
                </div>
                <div class="detail-item">
                    <div>æ—¥è½</div>
                    <div id="sunset">--:--</div>
                </div>
                <div class="detail-item">
                    <div>æ¹¿åº¦</div>
                    <div id="humidity">--%</div>
                </div>
                <div class="detail-item">
                    <div>é£é€Ÿ</div>
                    <div id="wind-speed">-- m/s</div>
                </div>
            </div>
        </div>
        
        <div class="calendar-section">
            <div class="today-info">
                <div class="today-date" id="today-date">2026å¹´1æœˆ6æ—¥</div>
                <div class="today-weekday" id="today-weekday">æ˜ŸæœŸäºŒ</div>
                <div class="today-lunar" id="today-lunar">å†œå†åä¸€æœˆå»¿ä¸ƒ</div>
            </div>
            
            <div class="huangli-section">
                <div class="huangli-title">é»„å†</div>
                <div class="huangli-content">
                    <div class="huangli-item">
                        <h4>å®œ</h4>
                        <p id="huangli-yi">ç¥­ç¥€ã€æ²æµ´ã€ç ´å±‹ã€åå£ã€ä½™äº‹å‹¿å–</p>
                    </div>
                    <div class="huangli-item">
                        <h4>å¿Œ</h4>
                        <p id="huangli-ji">å«å¨¶ã€å¼€å¸‚ã€å…¥å®…ã€å®‰åºŠã€ä½œç¶</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å¤©æ°”APIé…ç½®ï¼ˆä½¿ç”¨OpenWeatherMapå…è´¹APIï¼‰
        const WEATHER_API_KEY = 'YOUR_API_KEY'; // éœ€è¦æ›¿æ¢ä¸ºå®é™…çš„APIå¯†é’¥
        const WEATHER_API_URL = 'https://api.openweathermap.org/data/2.5/weather';
        
        // å…¨å±€å˜é‡
        let currentLocation = null;
        
        // å†œå†æ•°æ®
        const lunarInfo = [
            0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,
            0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,
            0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,
            0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,
            0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,
            0x06ca0,0x0b550,0x15355,0x04da0,0x0a5d0,0x14573,0x052d0,0x0a9a8,0x0e950,0x06aa0,
            0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,
            0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b5a0,0x195a6,
            0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,
            0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x055c0,0x0ab60,0x096d5,0x092e0,
            0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,
            0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,
            0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,
            0x05aa0,0x076a3,0x096d0,0x04bd7,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,
            0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0
        ];
        
        const solarMonth = [31,28,31,30,31,30,31,31,30,31,30,31];
        const Gan = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
        const Zhi = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
        const Animals = ["é¼ ","ç‰›","è™","å…”","é¾™","è›‡","é©¬","ç¾Š","çŒ´","é¸¡","ç‹—","çŒª"];
        const lunarMonth = ["æ­£","äºŒ","ä¸‰","å››","äº”","å…­","ä¸ƒ","å…«","ä¹","å","åä¸€","è…Š"];
        const lunarDayName = ["åˆ","å","å»¿","ä¸‰"];
        const jieqi = [
            "å°å¯’","å¤§å¯’","ç«‹æ˜¥","é›¨æ°´","æƒŠè›°","æ˜¥åˆ†","æ¸…æ˜","è°·é›¨","ç«‹å¤","å°æ»¡",
            "èŠ’ç§","å¤è‡³","å°æš‘","å¤§æš‘","ç«‹ç§‹","å¤„æš‘","ç™½éœ²","ç§‹åˆ†","å¯’éœ²","éœœé™",
            "ç«‹å†¬","å°é›ª","å¤§é›ª","å†¬è‡³"
        ];
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            displayTodayInfo();
            getLocation();
        });
        
        // è·å–ç”¨æˆ·ä½ç½®
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        currentLocation = {
                            lat: position.coords.latitude,
                            lon: position.coords.longitude
                        };
                        document.getElementById('location').textContent = `çº¬åº¦: ${currentLocation.lat.toFixed(4)}, ç»åº¦: ${currentLocation.lon.toFixed(4)}`;
                        getWeather();
                    },
                    error => {
                        document.getElementById('location').textContent = 'å®šä½å¤±è´¥: ' + error.message;
                        // ä½¿ç”¨é»˜è®¤ä½ç½®ï¼ˆåŒ—äº¬ï¼‰
                        currentLocation = { lat: 39.9042, lon: 116.4074 };
                        document.getElementById('location').textContent += ' | ä½¿ç”¨é»˜è®¤ä½ç½®: åŒ—äº¬';
                        getWeather();
                    }
                );
            } else {
                document.getElementById('location').textContent = 'æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†å®šä½';
                // ä½¿ç”¨é»˜è®¤ä½ç½®ï¼ˆåŒ—äº¬ï¼‰
                currentLocation = { lat: 39.9042, lon: 116.4074 };
                document.getElementById('location').textContent += ' | ä½¿ç”¨é»˜è®¤ä½ç½®: åŒ—äº¬';
                getWeather();
            }
        }
        
        // è·å–å¤©æ°”æ•°æ®
        function getWeather() {
            if (!currentLocation) return;
            
            const url = `${WEATHER_API_URL}?lat=${currentLocation.lat}&lon=${currentLocation.lon}&appid=${WEATHER_API_KEY}&units=metric&lang=zh_cn`;
            
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    displayWeather(data);
                })
                .catch(error => {
                    document.getElementById('weather-container').style.display = 'block';
                    document.getElementById('weather-desc').textContent = 'å¤©æ°”è·å–å¤±è´¥';
                    console.error('è·å–å¤©æ°”å¤±è´¥:', error);
                });
        }
        
        // æ˜¾ç¤ºå¤©æ°”æ•°æ®
        function displayWeather(data) {
            // å¤©æ°”å›¾æ ‡æ˜ å°„
            const weatherIcons = {
                '01d': 'â˜€ï¸', '01n': 'ğŸŒ™',
                '02d': 'â›…', '02n': 'â˜ï¸',
                '03d': 'â˜ï¸', '03n': 'â˜ï¸',
                '04d': 'â˜ï¸', '04n': 'â˜ï¸',
                '09d': 'ğŸŒ§ï¸', '09n': 'ğŸŒ§ï¸',
                '10d': 'ğŸŒ¦ï¸', '10n': 'ğŸŒ§ï¸',
                '11d': 'â›ˆï¸', '11n': 'â›ˆï¸',
                '13d': 'â„ï¸', '13n': 'â„ï¸',
                '50d': 'ğŸŒ«ï¸', '50n': 'ğŸŒ«ï¸'
            };
            
            document.getElementById('weather-icon').textContent = weatherIcons[data.weather[0].icon] || 'ğŸŒ¤ï¸';
            document.getElementById('temp').textContent = `${Math.round(data.main.temp)}Â°C`;
            document.getElementById('weather-desc').textContent = data.weather[0].description;
            
            // è½¬æ¢æ—¶é—´æˆ³ä¸ºæœ¬åœ°æ—¶é—´
            const sunriseTime = new Date(data.sys.sunrise * 1000);
            const sunsetTime = new Date(data.sys.sunset * 1000);
            
            document.getElementById('sunrise').textContent = sunriseTime.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('sunset').textContent = sunsetTime.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('humidity').textContent = `${data.main.humidity}%`;
            document.getElementById('wind-speed').textContent = `${data.wind.speed} m/s`;
            
            document.getElementById('weather-container').style.display = 'block';
        }
        
        // æ˜¾ç¤ºå½“å¤©ä¿¡æ¯
        function displayTodayInfo() {
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth() + 1;
            const day = today.getDate();
            
            // æ˜¾ç¤ºé˜³å†æ—¥æœŸ
            document.getElementById('today-date').textContent = `${year}å¹´${month}æœˆ${day}æ—¥`;
            
            // æ˜¾ç¤ºæ˜ŸæœŸå‡ 
            const weekdays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            document.getElementById('today-weekday').textContent = weekdays[today.getDay()];
            
            // æ˜¾ç¤ºé˜´å†æ—¥æœŸ
            const lunar = solarToLunar(year, month, day);
            document.getElementById('today-lunar').textContent = `å†œå†${lunarMonth[lunar.month-1]}æœˆ${getLunarDayName(lunar.day)}`;
            
            // æ˜¾ç¤ºé»„å†ä¿¡æ¯
            displayHuangli(lunar, today);
        }
        
        // é˜³å†è½¬é˜´å†
        function solarToLunar(year, month, day) {
            if (year < 1900 || year > 2100) {
                return { year: year, month: month, day: day, isleap: false };
            }
            
            if (month < 1 || month > 12) {
                return { year: year, month: month, day: day, isleap: false };
            }
            
            if (day < 1 || day > solarMonth[month-1]) {
                if (!(month == 2 && isLeap(year) && day == 29)) {
                    return { year: year, month: month, day: day, isleap: false };
                }
            }
            
            let i, leap = 0, temp = 0;
            let baseYear = 1900;
            let baseMonth = 1;
            let baseDay = 31;
            
            let offset = (Date.UTC(year, month-1, day) - Date.UTC(1900, 0, 31)) / 86400000;
            
            for (i = 1900; i < 2101 && offset > 0; i++) {
                temp = lYearDays(i);
                offset -= temp;
            }
            
            if (offset < 0) {
                offset += temp;
                i--;
            }
            
            let lunarYear = i;
            leap = leapMonth(i);
            let isLeap = false;
            
            for (i = 1; i < 13 && offset > 0; i++) {
                if (leap > 0 && i == (leap + 1) && isLeap == false) {
                    --i;
                    isLeap = true;
                    temp = leapDays(lunarYear);
                } else {
                    temp = monthDays(lunarYear, i);
                }
                
                if (isLeap == true && i == (leap + 1)) {
                    isLeap = false;
                }
                
                offset -= temp;
            }
            
            if (offset == 0 && leap > 0 && i == leap + 1) {
                if (isLeap) {
                    isLeap = false;
                } else {
                    isLeap = true;
                    --i;
                }
            }
            
            if (offset < 0) {
                offset += temp;
                --i;
            }
            
            let lunarMonth = i;
            let lunarDay = offset + 1;
            
            return { year: lunarYear, month: lunarMonth, day: lunarDay, isleap: isLeap };
        }
        
        // è·å–é˜´å†æ—¥æœŸåç§°
        function getLunarDayName(day) {
            if (day == 10) return "åˆå";
            if (day == 20) return "äºŒå";
            if (day == 30) return "ä¸‰å";
            
            let ten = Math.floor(day / 10);
            let unit = day % 10;
            
            return lunarDayName[ten] + (unit == 0 ? '' : 'ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹'[unit-1]);
        }
        
        // æ˜¾ç¤ºé»„å†ä¿¡æ¯
        function displayHuangli(lunar, solar) {
            // ç®€å•çš„é»„å†æ•°æ®ï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦æ›´å®Œæ•´çš„æ•°æ®
            const ganIndex = (lunar.year - 4) % 10;
            const zhiIndex = (lunar.year - 4) % 12;
            const sYear = ganIndex + 10 * ((solar.getFullYear() - 4) % 10);
            const sMonth = solar.getMonth();
            const sDay = solar.getDate();
            
            // è®¡ç®—å®œå’Œå¿Œï¼ˆç®€åŒ–ç‰ˆï¼‰
            const yiList = [
                "ç¥­ç¥€ã€ç¥ˆç¦ã€æ±‚å—£ã€å¼€å…‰ã€å‡ºè¡Œã€è§£é™¤ã€ä¼æœ¨ã€å‡ºç«ã€å…¥å®…ã€ç§»å¾™ã€å®‰åºŠã€æ‹†å¸ã€ä¿®é€ ã€æ ½ç§ã€ç ´åœŸã€è°¢åœŸ",
                "å«å¨¶ã€çº³é‡‡ã€è®¢ç›Ÿã€ç¥­ç¥€ã€ç¥ˆç¦ã€æ±‚å—£ã€å¼€å…‰ã€å‡ºè¡Œã€å‡ºç«ã€æ‹†å¸ã€ä¿®é€ ã€åŠ¨åœŸã€å…¥å®…ã€ç§»å¾™ã€å®‰åºŠã€ä¸Šæ¢ã€æ ½ç§ã€çº³ç•œã€ç ´åœŸã€å¯é’»ã€å®‰è‘¬",
                "ç¥­ç¥€ã€ç¥ˆç¦ã€æ±‚å—£ã€å¼€å…‰ã€å¼€å¸‚ã€äº¤æ˜“ã€ç«‹åˆ¸ã€å®‰åºŠã€å‡ºè¡Œã€æ‹†å¸",
                "ç¥­ç¥€ã€ç¥ˆç¦ã€æ±‚å—£ã€å¼€å…‰ã€å‡ºè¡Œã€è§£é™¤ã€ä¸Šæ¢ã€ç›–å±‹ã€ç§»å¾™ã€å®‰åºŠã€å…¥æ®“ã€ç ´åœŸã€å®‰è‘¬",
                "å«å¨¶ã€çº³é‡‡ã€è®¢ç›Ÿã€ç¥­ç¥€ã€ç¥ˆç¦ã€æ±‚å—£ã€å¼€å…‰ã€å‡ºè¡Œã€è§£é™¤ã€ä¼æœ¨ã€å‡ºç«ã€å…¥å®…ã€ç§»å¾™ã€å®‰åºŠã€æ‹†å¸ã€ä¿®é€ ã€æ ½ç§ã€ç ´åœŸã€è°¢åœŸ"
            ];
            
            const jiList = [
                "å«å¨¶ã€å¼€å¸‚ã€ç ´åœŸã€å®‰è‘¬",
                "å¼€å¸‚ã€äº¤æ˜“ã€ç ´åœŸã€å®‰è‘¬",
                "å«å¨¶ã€å…¥å®…ã€å®‰è‘¬",
                "å«å¨¶ã€å¼€å…‰ã€å¼€å¸‚ã€å®‰è‘¬",
                "å¼€å¸‚ã€ç ´åœŸã€å®‰è‘¬"
            ];
            
            // ä½¿ç”¨æ—¥æœŸå“ˆå¸Œæ¥é€‰æ‹©å®œå’Œå¿Œ
            const hash = (lunar.year + lunar.month + lunar.day) % yiList.length;
            document.getElementById('huangli-yi').textContent = yiList[hash];
            document.getElementById('huangli-ji').textContent = jiList[hash];
        }
        
        // åˆ¤æ–­æ˜¯å¦ä¸ºé—°å¹´
        function isLeap(year) {
            return (year % 4 == 0 && year % 100 != 0) || (year % 400 == 0);
        }
        
        // è·å–å†œå†å¹´çš„å¤©æ•°
        function lYearDays(y) {
            let i, sum = 348;
            for (i = 0x8000; i > 0x8; i >>= 1) {
                sum += (lunarInfo[y-1900] & i) ? 1 : 0;
            }
            return(sum + leapDays(y));
        }
        
        // è·å–å†œå†é—°æœˆå¤©æ•°
        function leapDays(y) {
            if (leapMonth(y)) {
                return((lunarInfo[y-1900] & 0x10000) ? 30 : 29);
            } else {
                return(0);
            }
        }
        
        // è·å–å†œå†æœˆçš„å¤©æ•°
        function monthDays(y, m) {
            return((lunarInfo[y-1900] & (0x10000 >> m)) ? 30 : 29);
        }
        
        // è·å–å†œå†é—°æœˆ
        function leapMonth(y) {
            return(lunarInfo[y-1900] & 0xf);
        }
    </script>
</body>
</html>
