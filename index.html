<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kindle å¤©æ°”æ—¥å†</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #fff;
            color: #000;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            font-size: 18px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ccc;
        }
        
        .weather-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        
        .weather-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .weather-icon {
            font-size: 48px;
        }
        
        .weather-temp {
            font-size: 36px;
            font-weight: bold;
        }
        
        .weather-desc {
            text-align: center;
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .detail-item {
            text-align: center;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 3px;
        }
        
        .calendar-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        
        .today-info {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .today-date {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .today-weekday {
            font-size: 24px;
            margin-bottom: 10px;
            color: #666;
        }
        
        .today-lunar {
            font-size: 20px;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 3px;
            display: inline-block;
        }
        
        .huangli-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
        }
        
        .huangli-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .huangli-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .huangli-item {
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 3px;
        }
        
        .huangli-item h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        
        .huangli-item p {
            margin: 0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 20px;
        }
        
        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 3px;
            margin-bottom: 20px;
        }
        #wind-speed {
            white-space: pre-line;
        }
        #weather-desc {
            white-space: pre-line;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Kindle å¤©æ°”æ—¥å†</h1>
            <div id="location">è²è²çš„å°å†</div>
        </div>
        
        <div id="weather-container" class="weather-section" style="display: none;">
            <div class="weather-main">
                <div class="weather-icon" id="weather-icon">â˜€ï¸</div>
                <div class="weather-temp" id="temp">--Â°C</div>
            </div>
            <div class="weather-desc" id="weather-desc">è·å–å¤©æ°”ä¸­...</div>
            <div class="weather-details">
                <div class="detail-item">
                    <div>æ—¥å‡º</div>
                    <div id="sunrise">--:--</div>
                </div>
                <div class="detail-item">
                    <div>æ—¥è½</div>
                    <div id="sunset">--:--</div>
                </div>
                <div class="detail-item">
                    <div>é£å‘</div>
                    <div id="winddirection">--</div>
                </div>
                <div class="detail-item">
                    <!--<div>é£é€Ÿ</div>-->
                    <div id="wind-speed">--m/h</div>
                </div>
            </div>
        </div>
        
        <div class="calendar-section">
            <div class="today-info">
                <div class="today-date" id="today-date">2026å¹´1æœˆ6æ—¥</div>
                <div class="today-weekday" id="today-weekday">æ˜ŸæœŸäºŒ</div>
                <div class="today-lunar" id="today-lunar">å†œå†åä¸€æœˆå»¿ä¸ƒ</div>
            </div>
            <!--é»„å†éƒ¨åˆ†å·²æ³¨é‡Šæ‰ï¼Œå¦‚éœ€å¯ç”¨è¯·å–æ¶ˆæ³¨é‡Š 
            <div class="huangli-section">
                <div class="huangli-title">é»„å†</div>
                <div class="huangli-content">
                    <div class="huangli-item">
                        <h4>å®œ</h4>
                        <p id="huangli-yi">ç¥­ç¥€ã€æ²æµ´ã€ç ´å±‹ã€åå£ã€ä½™äº‹å‹¿å–</p>
                    </div>
                    <div class="huangli-item">
                        <h4>å¿Œ</h4>
                        <p id="huangli-ji">å«å¨¶ã€å¼€å¸‚ã€å…¥å®…ã€å®‰åºŠã€ä½œç¶</p>
                    </div>
                </div>
            </div>
            -->
        </div>
    </div>

    <script>

        // ========================================
        // ç¼“å­˜å’Œç¦»çº¿æœºåˆ¶è¯´æ˜
        // ========================================
        // 1. ä½¿ç”¨ localStorage ç¼“å­˜å¤©æ°”æ•°æ®ï¼ˆé»˜è®¤1å°æ—¶è¿‡æœŸï¼‰
        // 2. å¦‚æœæœ¬åœ°æœ‰ç¼“å­˜ï¼Œç›´æ¥æ˜¾ç¤ºç¼“å­˜æ•°æ®ï¼Œä¸è¯·æ±‚API
        // 3. å¦‚æœAPIè¯·æ±‚å¤±è´¥ï¼Œè‡ªåŠ¨è¿›å…¥ç¦»çº¿æ¨¡å¼
        // 4. åœ¨Kindleç­‰ä½å¸¦å®½è®¾å¤‡ä¸Šæ›´ç¨³å®š
        // 5. å¤©æ°”æ•°æ®æ¥è‡ªGitHubä»“åº“ä¸­çš„weather.jsonæ–‡ä»¶
        // ========================================
        let currentLocation = { lat: 40.0997, lon: 116.3196 };
        
        // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶åˆ·æ–°å¤©æ°”
        function refreshWeather() {
            localStorage.removeItem(CACHE_KEY);
            localStorage.removeItem(CACHE_EXPIRY_KEY);
            getWeather();
        }
        
        // å†œå†æ•°æ®
        const lunarInfo = [
            0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,
            0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,
            0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,
            0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,
            0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,
            0x06ca0,0x0b550,0x15355,0x04da0,0x0a5d0,0x14573,0x052d0,0x0a9a8,0x0e950,0x06aa0,
            0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,
            0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b5a0,0x195a6,
            0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,
            0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x055c0,0x0ab60,0x096d5,0x092e0,
            0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,
            0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,
            0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,
            0x05aa0,0x076a3,0x096d0,0x04bd7,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,
            0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0
        ];
        
        const solarMonth = [31,28,31,30,31,30,31,31,30,31,30,31];
        const Gan = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
        const Zhi = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
        const Animals = ["é¼ ","ç‰›","è™","å…”","é¾™","è›‡","é©¬","ç¾Š","çŒ´","é¸¡","ç‹—","çŒª"];
        const lunarMonth = ["æ­£","äºŒ","ä¸‰","å››","äº”","å…­","ä¸ƒ","å…«","ä¹","å","å†¬","è…Š"];
        const lunarDayName = ["åˆ","å","å»¿","ä¸‰"];
        const jieqi = [
            "å°å¯’","å¤§å¯’","ç«‹æ˜¥","é›¨æ°´","æƒŠè›°","æ˜¥åˆ†","æ¸…æ˜","è°·é›¨","ç«‹å¤","å°æ»¡",
            "èŠ’ç§","å¤è‡³","å°æš‘","å¤§æš‘","ç«‹ç§‹","å¤„æš‘","ç™½éœ²","ç§‹åˆ†","å¯’éœ²","éœœé™",
            "ç«‹å†¬","å°é›ª","å¤§é›ª","å†¬è‡³"
        ];
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            displayTodayInfo();
            getWeather();
        });
          
        // ç¼“å­˜ç®¡ç†
        const CACHE_KEY = 'weather_cache';
        const CACHE_EXPIRY_KEY = 'weather_cache_expiry';
        const CACHE_DURATION = 3600000; // 1å°æ—¶

        // è·å–ç¼“å­˜çš„æ•°æ®
        function getCachedWeather() {
            const cached = localStorage.getItem(CACHE_KEY);
            const expiry = localStorage.getItem(CACHE_EXPIRY_KEY);
            
            if (cached && expiry && new Date().getTime() < parseInt(expiry)) {
                return JSON.parse(cached);
            }
            return null;
        }

        // ä¿å­˜ç¼“å­˜æ•°æ®
        function setCachedWeather(data) {
            try {
                localStorage.setItem(CACHE_KEY, JSON.stringify(data));
                localStorage.setItem(CACHE_EXPIRY_KEY, (new Date().getTime() + CACHE_DURATION).toString());
            } catch (e) {
                console.warn('æ— æ³•ä¿å­˜ç¼“å­˜ï¼š', e);
            }
        }

        // è·å–å¤©æ°”æ•°æ®ï¼ˆä»weather.jsonè¯»å–ï¼‰
        function getWeather() {
            // å…ˆå°è¯•ä½¿ç”¨ç¼“å­˜
            const cachedData = getCachedWeather();
            if (cachedData) {
                displayWeather(cachedData);
                return;
            }

            // ä»GitHubä»“åº“è¯»å–weather.json
            // è¯·æ›¿æ¢ä¸ºä½ çš„GitHubç”¨æˆ·åå’Œä»“åº“å
            const weatherJsonUrl = 'https://raw.githubusercontent.com/Jamierhu/Jamierhu.github.io/main/weather.json';
            
            fetch(weatherJsonUrl, { timeout: 5000 })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    setCachedWeather(data);
                    displayWeather(data);
                })
                .catch(error => {
                    console.error('è·å–å¤©æ°”å¤±è´¥:', error);
                    // å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œæ˜¾ç¤ºç¦»çº¿æç¤º
                    showWeatherOfflineMode();
                });
        }
        
        function getSunriseSunset(date = null, weatherData = null) {
            // å¦‚æœä¼ å…¥äº†å¤©æ°”æ•°æ®å¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨å…¶ä¸­çš„æ—¥å‡ºæ—¥è½æ—¶é—´
            if (weatherData && weatherData.sun) {
                document.getElementById('sunrise').textContent = weatherData.sun.sunrise;
                document.getElementById('sunset').textContent = weatherData.sun.sunset;
                return;
            }
            
            // å¦åˆ™æ˜¾ç¤ºé»˜è®¤å€¼
            document.getElementById('sunrise').textContent = '--:--';
            document.getElementById('sunset').textContent = '--:--';
        }

        // é£åŠ›ç­‰çº§æ•°æ®
        const windLevels = [
            {
                level: 0,
                name: "æ— é£",
                maxSpeed: 0.72, // m/h
                description: "çƒŸå‚ç›´ä¸Šå‡ï¼Œæ°´é¢å¹³é™å¦‚é•œ",
                effect: "é€‚å®œæ‰€æœ‰æˆ·å¤–æ´»åŠ¨ï¼Œç©ºæ°”é™æ­¢"
            },
            {
                level: 1,
                name: "è½¯é£",
                maxSpeed: 5.4,
                description: "çƒŸèƒ½è¡¨ç¤ºé£å‘ï¼Œé£å‘æ ‡ä¸è½¬åŠ¨",
                effect: "å‡ ä¹æ„Ÿè§‰ä¸åˆ°é£ï¼Œéå¸¸èˆ’é€‚"
            },
            {
                level: 2,
                name: "è½»é£",
                maxSpeed: 11.9,
                description: "äººè„¸æ„Ÿè§‰æœ‰é£ï¼Œæ ‘å¶å¾®å“",
                effect: "æ„Ÿè§‰èˆ’é€‚ï¼Œé€‚å®œæ•£æ­¥"
            },
            {
                level: 3,
                name: "å¾®é£",
                maxSpeed: 19.4,
                description: "æ ‘å¶å’Œå°ææ‘‡åŠ¨ï¼Œæ——å¸œå±•å¼€",
                effect: "æ——å¸œå¯å±•å¼€ï¼Œé€‚å®œæˆ·å¤–æ´»åŠ¨"
            },
            {
                level: 4,
                name: "å’Œé£",
                maxSpeed: 28.4,
                description: "å°˜åœŸã€çº¸å¼ é£æ‰¬ï¼Œå°æ ‘ææ‘‡åŠ¨",
                effect: "å¯èƒ½æœ‰è½»å¾®æ‰¬å°˜ï¼Œä¸å½±å“æ­£å¸¸æ´»åŠ¨"
            },
            {
                level: 5,
                name: "æ¸…é£",
                maxSpeed: 38.5,
                description: "å°æ ‘æ‘‡æ‘†ï¼Œå†…é™†æ°´é¢æœ‰å°æ³¢",
                effect: "å°æ ‘æ‘‡æ‘†ï¼Œæ¹–é¢èµ·æ³¢æµª"
            },
            {
                level: 6,
                name: "å¼ºé£",
                maxSpeed: 49.7,
                description: "å¤§æ ‘ææ‘‡åŠ¨ï¼Œç”µçº¿å‘¼å‘¼æœ‰å£°ï¼Œä¸¾ä¼å›°éš¾",
                effect: "æ‰“ä¼å›°éš¾ï¼Œéœ€æ³¨æ„å®‰å…¨"
            },
            {
                level: 7,
                name: "åŠ²é£",
                maxSpeed: 61.6,
                description: "å…¨æ ‘æ‘‡åŠ¨ï¼Œè¿é£è¡Œèµ°å›°éš¾",
                effect: "æ­¥è¡Œå›°éš¾ï¼Œå»ºè®®å‡å°‘å¤–å‡º"
            },
            {
                level: 8,
                name: "å¤§é£",
                maxSpeed: 74.5,
                description: "æŠ˜æ¯å°æï¼Œäººè¡Œèµ°é˜»åŠ›å¾ˆå¤§",
                effect: "å¯èƒ½æœ‰æ ‘ææŠ˜æ–­ï¼Œæ³¨æ„é«˜ç©ºå ç‰©"
            },
            {
                level: 9,
                name: "çƒˆé£",
                maxSpeed: 87.9,
                description: "å±‹é¡¶ç“¦ç‰‡å¯èƒ½ç§»åŠ¨ï¼ŒçƒŸå›±å—æŸ",
                effect: "å¯èƒ½é€ æˆè½»å¾®å»ºç­‘æŸå"
            },
            {
                level: 10,
                name: "ç‹‚é£",
                maxSpeed: 102.1,
                description: "æ ‘æœ¨æ‹”èµ·ï¼Œå»ºç­‘ç‰©æœ‰æŸå",
                effect: "æ ‘æœ¨å¯èƒ½è¢«è¿æ ¹æ‹”èµ·ï¼Œæ³¨æ„å®‰å…¨"
            },
            {
                level: 11,
                name: "æš´é£",
                maxSpeed: 117.2,
                description: "é‡å¤§ç ´åï¼Œé™†ä¸Šå°‘è§",
                effect: "é‡å¤§ç¾å®³ï¼Œé¿å…å¤–å‡º"
            },
            {
                level: 12,
                name: "é£“é£",
                maxSpeed: Infinity,
                description: "æ‘§æ¯æ€§ç ´åï¼Œæµ·æµªæ»”å¤©",
                effect: "æç«¯å±é™©ï¼Œå¯»æ‰¾åšå›ºæ©ä½“"
            }
        ];

        function getWindDirection(deg) {
            if (deg >= 337.5 || deg < 22.5) return 'åŒ—é£';
            if (deg < 67.5) return 'ä¸œåŒ—é£';
            if (deg < 112.5) return 'ä¸œé£';
            if (deg < 157.5) return 'ä¸œå—é£';
            if (deg < 202.5) return 'å—é£';
            if (deg < 247.5) return 'è¥¿å—é£';
            if (deg < 292.5) return 'è¥¿é£';
            return 'è¥¿åŒ—é£';
        }

        const WMO_WEATHER_CODE = {
        0: { 
            text: 'æ™´', 
            icon: 'â˜€ï¸',
            poetry: 'æ™´ç©ºä¸€é¹¤æ’äº‘ä¸Šï¼Œä¾¿å¼•è¯—æƒ…åˆ°ç¢§éœ„ã€‚',
            author: 'åˆ˜ç¦¹é”¡',
            poemName: 'ç§‹è¯'
        },
        1: { 
            text: 'å°‘äº‘', 
            icon: 'ğŸŒ¤',
            poetry: 'ç™½äº‘ä¸€ç‰‡å»æ‚ æ‚ ï¼Œé’æ«æµ¦ä¸Šä¸èƒœæ„ã€‚',
            author: 'å¼ è‹¥è™š',
            poemName: 'æ˜¥æ±ŸèŠ±æœˆå¤œ'
        },
        2: { 
            text: 'å¤šäº‘', 
            icon: 'â›…',
            poetry: 'è¡Œåˆ°æ°´ç©·å¤„ï¼Œåçœ‹äº‘èµ·æ—¶ã€‚',
            author: 'ç‹ç»´',
            poemName: 'ç»ˆå—åˆ«ä¸š'
        },
        3: { 
            text: 'é˜´', 
            icon: 'â˜ï¸',
            poetry: 'é»‘äº‘å‹åŸåŸæ¬²æ‘§ï¼Œç”²å…‰å‘æ—¥é‡‘é³å¼€ã€‚',
            author: 'æè´º',
            poemName: 'é›é—¨å¤ªå®ˆè¡Œ'
        },

        45: { 
            text: 'é›¾', 
            icon: 'ğŸŒ«',
            poetry: 'é›¾å¤±æ¥¼å°ï¼Œæœˆè¿·æ´¥æ¸¡ã€‚',
            author: 'ç§¦è§‚',
            poemName: 'è¸èè¡ŒÂ·éƒ´å·æ—…èˆ'
        },
        48: { 
            text: 'å†»é›¾', 
            icon: 'ğŸŒ«â„ï¸',
            poetry: 'é›¾å‡‡æ²†ç €ï¼Œå¤©ä¸äº‘ä¸å±±ä¸æ°´ï¼Œä¸Šä¸‹ä¸€ç™½ã€‚',
            author: 'å¼ å²±',
            poemName: 'æ¹–å¿ƒäº­çœ‹é›ª'
        },

        51: { 
            text: 'å°æ¯›æ¯›é›¨', 
            icon: 'ğŸŒ¦',
            poetry: 'ç»†é›¨æ¹¿è¡£çœ‹ä¸è§ï¼Œé—²èŠ±è½åœ°å¬æ— å£°ã€‚',
            author: 'åˆ˜é•¿å¿',
            poemName: 'åˆ«ä¸¥å£«å…ƒ'
        },
        53: { 
            text: 'ä¸­æ¯›æ¯›é›¨', 
            icon: 'ğŸŒ¦',
            poetry: 'éšé£æ½œå…¥å¤œï¼Œæ¶¦ç‰©ç»†æ— å£°ã€‚',
            author: 'æœç”«',
            poemName: 'æ˜¥å¤œå–œé›¨'
        },
        55: { 
            text: 'å¼ºæ¯›æ¯›é›¨', 
            icon: 'ğŸŒ§',
            poetry: 'ç»†é›¨é±¼å„¿å‡ºï¼Œå¾®é£ç‡•å­æ–œã€‚',
            author: 'æœç”«',
            poemName: 'æ°´æ§›é£å¿ƒäºŒé¦–'
        },
        56: { 
            text: 'å†»æ¯›æ¯›é›¨', 
            icon: 'ğŸŒ§â„ï¸',
            poetry: 'å¯’é›¨è¿æ±Ÿå¤œå…¥å´ï¼Œå¹³æ˜é€å®¢æ¥šå±±å­¤ã€‚',
            author: 'ç‹æ˜Œé¾„',
            poemName: 'èŠ™è“‰æ¥¼é€è¾›æ¸'
        },
        57: { 
            text: 'å¼ºå†»æ¯›æ¯›é›¨', 
            icon: 'ğŸŒ§â„ï¸',
            poetry: 'å¤œé˜‘å§å¬é£å¹é›¨ï¼Œé“é©¬å†°æ²³å…¥æ¢¦æ¥ã€‚',
            author: 'é™†æ¸¸',
            poemName: 'åä¸€æœˆå››æ—¥é£é›¨å¤§ä½œ'
        },

        61: { 
            text: 'å°é›¨', 
            icon: 'ğŸŒ§',
            poetry: 'å¤©è¡—å°é›¨æ¶¦å¦‚é…¥ï¼Œè‰è‰²é¥çœ‹è¿‘å´æ— ã€‚',
            author: 'éŸ©æ„ˆ',
            poemName: 'æ—©æ˜¥å‘ˆæ°´éƒ¨å¼ åå…«å‘˜å¤–'
        },
        63: { 
            text: 'ä¸­é›¨', 
            icon: 'ğŸŒ§',
            poetry: 'æ˜¥æ½®å¸¦é›¨æ™šæ¥æ€¥ï¼Œé‡æ¸¡æ— äººèˆŸè‡ªæ¨ªã€‚',
            author: 'éŸ¦åº”ç‰©',
            poemName: 'æ»å·è¥¿æ¶§'
        },
        65: { 
            text: 'å¤§é›¨', 
            icon: 'ğŸŒ§ğŸŒ§',
            poetry: 'é»‘äº‘ç¿»å¢¨æœªé®å±±ï¼Œç™½é›¨è·³ç ä¹±å…¥èˆ¹ã€‚',
            author: 'è‹è½¼',
            poemName: 'å…­æœˆäºŒåä¸ƒæ—¥æœ›æ¹–æ¥¼é†‰ä¹¦'
        },
        66: { 
            text: 'å†»é›¨', 
            icon: 'ğŸŒ§â„ï¸',
            poetry: 'åƒµå§å­¤æ‘ä¸è‡ªå“€ï¼Œå°šæ€ä¸ºå›½æˆè½®å°ã€‚',
            author: 'é™†æ¸¸',
            poemName: 'åä¸€æœˆå››æ—¥é£é›¨å¤§ä½œ'
        },
        67: { 
            text: 'å¼ºå†»é›¨', 
            icon: 'ğŸŒ§â„ï¸',
            poetry: 'é£åˆ€éœœå‰‘ä¸¥ç›¸é€¼ï¼Œå‡„é£å¯’é›¨ä¸èƒœæ‚²ã€‚',
            author: 'æ›¹é›ªèŠ¹',
            poemName: 'çº¢æ¥¼æ¢¦Â·è‘¬èŠ±åŸ'
        },

        71: { 
            text: 'å°é›ª', 
            icon: 'â„ï¸',
            poetry: 'å°é›ªæ™´æ²™ä¸ä½œæ³¥ï¼Œç–å¸˜çº¢æ—¥å¼„æœæ™–ã€‚',
            author: 'é»„åº­åš',
            poemName: 'æ˜¥è¿‘å››ç»å¥'
        },
        73: { 
            text: 'ä¸­é›ª', 
            icon: 'â„ï¸â„ï¸',
            poetry: 'å¿½å¦‚ä¸€å¤œæ˜¥é£æ¥ï¼Œåƒæ ‘ä¸‡æ ‘æ¢¨èŠ±å¼€ã€‚',
            author: 'å²‘å‚',
            poemName: 'ç™½é›ªæ­Œé€æ­¦åˆ¤å®˜å½’äº¬'
        },
        75: { 
            text: 'å¤§é›ª', 
            icon: 'â„ï¸â„ï¸â„ï¸',
            poetry: 'ç‡•å±±é›ªèŠ±å¤§å¦‚å¸­ï¼Œç‰‡ç‰‡å¹è½è½©è¾•å°ã€‚',
            author: 'æç™½',
            poemName: 'åŒ—é£è¡Œ'
        },
        77: { 
            text: 'é›ªç²’', 
            icon: 'ğŸŒ¨',
            poetry: 'æ’’ç›ç©ºä¸­å·®å¯æ‹Ÿï¼Œæœªè‹¥æŸ³çµ®å› é£èµ·ã€‚',
            author: 'è°¢é“éŸ«',
            poemName: 'å’é›ªè”å¥'
        },

        80: { 
            text: 'å°é˜µé›¨', 
            icon: 'ğŸŒ¦',
            poetry: 'ä¸œè¾¹æ—¥å‡ºè¥¿è¾¹é›¨ï¼Œé“æ˜¯æ— æ™´å´æœ‰æ™´ã€‚',
            author: 'åˆ˜ç¦¹é”¡',
            poemName: 'ç«¹æè¯äºŒé¦–Â·å…¶ä¸€'
        },
        81: { 
            text: 'ä¸­é˜µé›¨', 
            icon: 'ğŸŒ§',
            poetry: 'é›·å£°åƒå¶‚è½ï¼Œé›¨è‰²ä¸‡å³°æ¥ã€‚',
            author: 'ææ”€é¾™',
            poemName: 'å¹¿é˜³å±±é“ä¸­'
        },
        82: { 
            text: 'å¼ºé˜µé›¨', 
            icon: 'ğŸŒ§ğŸŒ§',
            poetry: 'é£å¦‚æ‹”å±±æ€’ï¼Œé›¨å¦‚å†³æ²³å€¾ã€‚',
            author: 'é™†æ¸¸',
            poemName: 'å¤§é£é›¨ä¸­ä½œ'
        },
        85: { 
            text: 'å°é˜µé›ª', 
            icon: 'ğŸŒ¨',
            poetry: 'æ—‹æ‰‘ç å¸˜è¿‡ç²‰å¢™ï¼Œè½»äºæŸ³çµ®é‡äºéœœã€‚',
            author: 'æå•†éš',
            poemName: 'å¯¹é›ªäºŒé¦–'
        },
        86: { 
            text: 'å¼ºé˜µé›ª', 
            icon: 'ğŸŒ¨â„ï¸',
            poetry: 'æˆ˜é€€ç‰é¾™ä¸‰ç™¾ä¸‡ï¼Œè´¥é³æ®‹ç”²æ»¡å¤©é£ã€‚',
            author: 'å¼ å…ƒ',
            poemName: 'é›ª'
        },

        95: { 
            text: 'é›·æš´', 
            icon: 'â›ˆ',
            poetry: 'åˆ—ç¼ºéœ¹é›³ï¼Œä¸˜å³¦å´©æ‘§ã€‚æ´å¤©çŸ³æ‰‰ï¼Œè¨‡ç„¶ä¸­å¼€ã€‚',
            author: 'æç™½',
            poemName: 'æ¢¦æ¸¸å¤©å§¥åŸç•™åˆ«'
        },
        96: { 
            text: 'é›·æš´ä¼´å°å†°é›¹', 
            icon: 'â›ˆğŸ§Š',
            poetry: 'é›·è½¦é©¾é›¨é¾™å°½èµ·ï¼Œç”µè¡ŒåŠç©ºå¦‚ç‹‚çŸ¢ã€‚',
            author: 'é™†æ¸¸',
            poemName: 'ä¸­å¤œé—»å¤§é›·é›¨'
        },
        99: { 
            text: 'é›·æš´ä¼´å¤§å†°é›¹', 
            icon: 'â›ˆğŸ§ŠğŸ§Š',
            poetry: 'é›·å…¬ç °è¨‡éœ‡å¤©é¼“ï¼Œå¸é£ä¸°éš†å¬é˜¿é¦™ã€‚',
            author: 'æ¨ä¸‡é‡Œ',
            poemName: 'è…Šæœˆæ‘ç”°ä¹åºœ'
        }
        };

        // æ‰©å±•ç‰ˆæœ¬ï¼šæ ¹æ®å­£èŠ‚å’Œæ˜¼å¤œå˜æ¢è¯—å¥
        const SEASONAL_POETRY = {
        spring: {
            0: 'æ˜¥æ—¥æ¸¸ï¼ŒæèŠ±å¹æ»¡å¤´ã€‚',
            61: 'å¥½é›¨çŸ¥æ—¶èŠ‚ï¼Œå½“æ˜¥ä¹ƒå‘ç”Ÿã€‚',
            71: 'ç™½é›ªå´å«Œæ˜¥è‰²æ™šï¼Œæ•…ç©¿åº­æ ‘ä½œé£èŠ±ã€‚'
        },
        summer: {
            0: 'ç»¿æ ‘é˜´æµ“å¤æ—¥é•¿ï¼Œæ¥¼å°å€’å½±å…¥æ± å¡˜ã€‚',
            95: 'é»‘äº‘ç¿»å¢¨æœªé®å±±ï¼Œç™½é›¨è·³ç ä¹±å…¥èˆ¹ã€‚',
            65: 'é£é©±æ€¥é›¨æ´’é«˜åŸï¼Œäº‘å‹è½»é›·æ®·åœ°å£°ã€‚'
        },
        autumn: {
            0: 'ç©ºå±±æ–°é›¨åï¼Œå¤©æ°”æ™šæ¥ç§‹ã€‚',
            3: 'ç§‹é˜´ä¸æ•£éœœé£æ™šï¼Œç•™å¾—æ¯è·å¬é›¨å£°ã€‚',
            71: 'åæœˆæ±Ÿå—å¤©æ°”å¥½ï¼Œå¯æ€œå†¬æ™¯ä¼¼æ˜¥åã€‚'
        },
        winter: {
            0: 'å†¬æ—¥å¯çˆ±ï¼Œå¤æ—¥å¯ç•ã€‚',
            75: 'åŒ—é£å·åœ°ç™½è‰æŠ˜ï¼Œèƒ¡å¤©å…«æœˆå³é£é›ªã€‚',
            48: 'å²æš®é˜´é˜³å‚¬çŸ­æ™¯ï¼Œå¤©æ¶¯éœœé›ªéœå¯’å®µã€‚'
        },
        night: {
            0: 'æ˜Ÿå‚å¹³é‡é˜”ï¼Œæœˆæ¶Œå¤§æ±Ÿæµã€‚',
            61: 'å¤œé›¨å‰ªæ˜¥éŸ­ï¼Œæ–°ç‚Šé—´é»„ç²±ã€‚',
            45: 'é›¾å¤±æ¥¼å°ï¼Œæœˆè¿·æ´¥æ¸¡ã€‚'
        }
        };

        // ä½¿ç”¨ç¤ºä¾‹å‡½æ•°
        function getWeatherInfo(code, options = {}) {
        const weather = WMO_WEATHER_CODE[code] || WMO_WEATHER_CODE[0];
        const { season = 'spring', isNight = false } = options;
        
        let poetry = weather.poetry;
        
        // å¦‚æœæœ‰å­£èŠ‚æ€§è¯—å¥ï¼Œä¼˜å…ˆä½¿ç”¨
        if (SEASONAL_POETRY[season] && SEASONAL_POETRY[season][code]) {
            poetry = SEASONAL_POETRY[season][code];
        }
        
        // å¦‚æœæ˜¯å¤œæ™šä¸”æœ‰å¤œæ™šè¯—å¥
        if (isNight && SEASONAL_POETRY.night && SEASONAL_POETRY.night[code]) {
            poetry = SEASONAL_POETRY.night[code];
        }
        
        return {
            ...weather,
            poetry: poetry,
            fullPoetry: `${poetry} â€”â€” ${weather.author}ã€Š${weather.poemName}ã€‹`
        };
        }

        // è·å–å½“å‰å­£èŠ‚
        function getCurrentSeason() {
        const month = new Date().getMonth() + 1;
        if (month >= 3 && month <= 5) return 'spring';
        if (month >= 6 && month <= 8) return 'summer';
        if (month >= 9 && month <= 11) return 'autumn';
        return 'winter';
        }

        // å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹
        function displayWeatherWithPoetry(weatherCode, isNight) {
            const season = getCurrentSeason();
            const weatherInfo = getWeatherInfo(weatherCode, {
                season: season,
                isNight: isNight
            });
            
            return `
                ${season === 'spring' ? 'æ˜¥' : 
                season === 'summer' ? 'å¤' : 
                season === 'autumn' ? 'ç§‹' : 'å†¬'}å­£\n
                ${weatherInfo.poetry}\n
                ${weatherInfo.author}ã€Š${weatherInfo.poemName}ã€‹
            `;
        }

        // ç¦»çº¿æ¨¡å¼ï¼šAPIè¯·æ±‚å¤±è´¥æ—¶çš„é™çº§æ–¹æ¡ˆ
        function showWeatherOfflineMode() {
            document.getElementById('weather-icon').textContent = 'â“';
            document.getElementById('temp').textContent = '--Â°C';
            document.getElementById('weather-desc').textContent = 'ç¦»çº¿æ¨¡å¼ï¼šæ— æ³•è·å–å¤©æ°”æ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
            document.getElementById('sunrise').textContent = '--:--';
            document.getElementById('sunset').textContent = '--:--';
            document.getElementById('winddirection').textContent = '--';
            document.getElementById('wind-speed').textContent = 'æ— æ•°æ®';
            document.getElementById('weather-container').style.display = 'block';
        }

        // æ˜¾ç¤ºå¤©æ°”æ•°æ®
        function displayWeather(data) {
 
            if(data.current_weather.is_day === 0 && 
                (data.current_weather.weathercode >= 0 || data.current_weather.weathercode <= 2)) {
                document.getElementById('weather-icon').textContent = 'ğŸŒ™';
            } else {
                document.getElementById('weather-icon').textContent = WMO_WEATHER_CODE[data.current_weather.weathercode].icon;
            }

            document.getElementById('temp').textContent = `${data.current_weather.temperature}Â°C`;

            document.getElementById('weather-desc').textContent = `${displayWeatherWithPoetry(data.current_weather.weathercode, data.current_weather.is_day === 0)}`;         
            // è·å–å¹¶æ˜¾ç¤ºæ—¥å‡ºæ—¥è½æ—¶é—´ï¼ˆä»weather.jsonä¸­è·å–ï¼‰
            getSunriseSunset(null, data);
            document.getElementById('winddirection').textContent = `${getWindDirection(data.current_weather.winddirection)}`;

            for (let i = 0; i < windLevels.length; i++) {
                if (data.current_weather.windspeed <= windLevels[i].maxSpeed) {
                    document.getElementById('wind-speed').textContent = `${windLevels[i].level}çº§ ${windLevels[i].name}\r\n${windLevels[i].description}`;
                    break;
                }
            }
            //document.getElementById('wind-speed').textContent = `${data.current_weather.windspeed}m/h`;
            
            document.getElementById('weather-container').style.display = 'block';
        }
        
        // æ˜¾ç¤ºå½“å¤©ä¿¡æ¯
        function displayTodayInfo() {
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth() + 1;
            const day = today.getDate();
            
            // æ˜¾ç¤ºé˜³å†æ—¥æœŸ
            document.getElementById('today-date').textContent = `${year}å¹´${month}æœˆ${day}æ—¥`;
            
            // æ˜¾ç¤ºæ˜ŸæœŸå‡ 
            const weekdays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            document.getElementById('today-weekday').textContent = weekdays[today.getDay()];
            
            // æ˜¾ç¤ºé˜´å†æ—¥æœŸ
            const lunar = solarToLunar(year, month, day);
            document.getElementById('today-lunar').textContent = `${lunarMonth[lunar.month-1]}æœˆ${getLunarDayName(lunar.day)}`;
            
            // æ˜¾ç¤ºé»„å†ä¿¡æ¯
            //displayHuangli(lunar, today);
        }
        
        // é˜³å†è½¬é˜´å†
        function solarToLunar(year, month, day) {
            if (year < 1900 || year > 2100) {
                return { year: year, month: month, day: day, isleap: false };
            }
            
            if (month < 1 || month > 12) {
                return { year: year, month: month, day: day, isleap: false };
            }
            
            if (day < 1 || day > solarMonth[month-1]) {
                if (!(month == 2 && isLeap(year) && day == 29)) {
                    return { year: year, month: month, day: day, isleap: false };
                }
            }
            
            let i, leap = 0, temp = 0;
            let baseYear = 1900;
            let baseMonth = 1;
            let baseDay = 31;
            
            let offset = (Date.UTC(year, month-1, day) - Date.UTC(1900, 0, 31)) / 86400000;
            
            for (i = 1900; i < 2101 && offset > 0; i++) {
                temp = lYearDays(i);
                offset -= temp;
            }
            
            if (offset < 0) {
                offset += temp;
                i--;
            }
            
            let lunarYear = i;
            leap = leapMonth(i);
            let isLeap = false;
            
            for (i = 1; i < 13 && offset > 0; i++) {
                if (leap > 0 && i == (leap + 1) && isLeap == false) {
                    --i;
                    isLeap = true;
                    temp = leapDays(lunarYear);
                } else {
                    temp = monthDays(lunarYear, i);
                }
                
                if (isLeap == true && i == (leap + 1)) {
                    isLeap = false;
                }
                
                offset -= temp;
            }
            
            if (offset == 0 && leap > 0 && i == leap + 1) {
                if (isLeap) {
                    isLeap = false;
                } else {
                    isLeap = true;
                    --i;
                }
            }
            
            if (offset < 0) {
                offset += temp;
                --i;
            }
            
            let lunarMonth = i;
            let lunarDay = offset + 1;
            
            return { year: lunarYear, month: lunarMonth, day: lunarDay, isleap: isLeap };
        }
        
        // è·å–é˜´å†æ—¥æœŸåç§°
        function getLunarDayName(day) {
            if (day == 10) return "åˆå";
            if (day == 20) return "äºŒå";
            if (day == 30) return "ä¸‰å";
            
            let ten = Math.floor(day / 10);
            let unit = day % 10;
            
            return lunarDayName[ten] + (unit == 0 ? '' : 'ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹'[unit-1]);
        }
        
        // æ˜¾ç¤ºé»„å†ä¿¡æ¯
        function displayHuangli(lunar, solar) {
            // ç®€å•çš„é»„å†æ•°æ®ï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦æ›´å®Œæ•´çš„æ•°æ®
            const ganIndex = (lunar.year - 4) % 10;
            const zhiIndex = (lunar.year - 4) % 12;
            const sYear = ganIndex + 10 * ((solar.getFullYear() - 4) % 10);
            const sMonth = solar.getMonth();
            const sDay = solar.getDate();
            
            // è®¡ç®—å®œå’Œå¿Œï¼ˆç®€åŒ–ç‰ˆï¼‰
            const yiList = [
                "ç¥­ç¥€ã€ç¥ˆç¦ã€æ±‚å—£ã€å¼€å…‰ã€å‡ºè¡Œã€è§£é™¤ã€ä¼æœ¨ã€å‡ºç«ã€å…¥å®…ã€ç§»å¾™ã€å®‰åºŠã€æ‹†å¸ã€ä¿®é€ ã€æ ½ç§ã€ç ´åœŸã€è°¢åœŸ",
                "å«å¨¶ã€çº³é‡‡ã€è®¢ç›Ÿã€ç¥­ç¥€ã€ç¥ˆç¦ã€æ±‚å—£ã€å¼€å…‰ã€å‡ºè¡Œã€å‡ºç«ã€æ‹†å¸ã€ä¿®é€ ã€åŠ¨åœŸã€å…¥å®…ã€ç§»å¾™ã€å®‰åºŠã€ä¸Šæ¢ã€æ ½ç§ã€çº³ç•œã€ç ´åœŸã€å¯é’»ã€å®‰è‘¬",
                "ç¥­ç¥€ã€ç¥ˆç¦ã€æ±‚å—£ã€å¼€å…‰ã€å¼€å¸‚ã€äº¤æ˜“ã€ç«‹åˆ¸ã€å®‰åºŠã€å‡ºè¡Œã€æ‹†å¸",
                "ç¥­ç¥€ã€ç¥ˆç¦ã€æ±‚å—£ã€å¼€å…‰ã€å‡ºè¡Œã€è§£é™¤ã€ä¸Šæ¢ã€ç›–å±‹ã€ç§»å¾™ã€å®‰åºŠã€å…¥æ®“ã€ç ´åœŸã€å®‰è‘¬",
                "å«å¨¶ã€çº³é‡‡ã€è®¢ç›Ÿã€ç¥­ç¥€ã€ç¥ˆç¦ã€æ±‚å—£ã€å¼€å…‰ã€å‡ºè¡Œã€è§£é™¤ã€ä¼æœ¨ã€å‡ºç«ã€å…¥å®…ã€ç§»å¾™ã€å®‰åºŠã€æ‹†å¸ã€ä¿®é€ ã€æ ½ç§ã€ç ´åœŸã€è°¢åœŸ"
            ];
            
            const jiList = [
                "å«å¨¶ã€å¼€å¸‚ã€ç ´åœŸã€å®‰è‘¬",
                "å¼€å¸‚ã€äº¤æ˜“ã€ç ´åœŸã€å®‰è‘¬",
                "å«å¨¶ã€å…¥å®…ã€å®‰è‘¬",
                "å«å¨¶ã€å¼€å…‰ã€å¼€å¸‚ã€å®‰è‘¬",
                "å¼€å¸‚ã€ç ´åœŸã€å®‰è‘¬"
            ];
            
            // ä½¿ç”¨æ—¥æœŸå“ˆå¸Œæ¥é€‰æ‹©å®œå’Œå¿Œ
            const hash = (lunar.year + lunar.month + lunar.day) % yiList.length;
            document.getElementById('huangli-yi').textContent = yiList[hash];
            document.getElementById('huangli-ji').textContent = jiList[hash];
        }
        
        // åˆ¤æ–­æ˜¯å¦ä¸ºé—°å¹´
        function isLeap(year) {
            return (year % 4 == 0 && year % 100 != 0) || (year % 400 == 0);
        }
        
        // è·å–å†œå†å¹´çš„å¤©æ•°
        function lYearDays(y) {
            let i, sum = 348;
            for (i = 0x8000; i > 0x8; i >>= 1) {
                sum += (lunarInfo[y-1900] & i) ? 1 : 0;
            }
            return(sum + leapDays(y));
        }
        
        // è·å–å†œå†é—°æœˆå¤©æ•°
        function leapDays(y) {
            if (leapMonth(y)) {
                return((lunarInfo[y-1900] & 0x10000) ? 30 : 29);
            } else {
                return(0);
            }
        }
        
        // è·å–å†œå†æœˆçš„å¤©æ•°
        function monthDays(y, m) {
            return((lunarInfo[y-1900] & (0x10000 >> m)) ? 30 : 29);
        }
        
        // è·å–å†œå†é—°æœˆ
        function leapMonth(y) {
            return(lunarInfo[y-1900] & 0xf);
        }
    </script>
</body>
</html>
